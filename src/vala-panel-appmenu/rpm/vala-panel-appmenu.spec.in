Name: @CMAKE_PROJECT_NAME@
Version: @CPACK_PACKAGE_VERSION@
Release: @CPACK_PACKAGE_RELEASE@%{?dist}
Group: User Interface/Desktops
%if %{defined suse_version}
License: LGPL-3.0+
%else
License: LGPLv3.0+
%endif
URL: https://github.com/rilian-la-te/%{name}
Source: @CPACK_SOURCE_PACKAGE_FILE_NAME@.tar.gz
Summary: This package provides Application Menu plugin for vala-panel
BuildRoot: %{_tmppath}/@CMAKE_PROJECT_NAME@-%{version}-%{release}-root
BuildRequires: cmake >= 2.8.0
BuildRequires: gettext
BuildRequires: vala >= 0.24.0
BuildRequires: pkgconfig(gtk+-2.0) >= 2.24.0
BuildRequires: pkgconfig(gtk+-3.0) >= 3.12.0
BuildRequires: pkgconfig(libpeas-1.0) >= 1.2.0
BuildRequires: pkgconfig(libbamf3)
BuildRequires: pkgconfig(libxfce4panel-2.0)
BuildRequires: pkgconfig(libxfconf-0)
BuildRequires: pkgconfig(vala-panel)
BuildRequires: pkgconfig(libwnck-3.0) >= 3.4.0
BuildRequires: pkgconfig(x11)
Requires: bamf-daemon
Provides: vala-panel-appmenu-plugin

%description
This is Application Menu (Global Menu) plugin.
It built using Unity protocol and libraries,
and share all Unity limitations and advancements.

%prep
%setup -q 

%build
cmake . -DGSETTINGS_COMPILE=OFF -DCMAKE_INSTALL_PREFIX=%{_prefix} -DCMAKE_INSTALL_INCLUDEDIR=%{_includedir} -DCMAKE_INSTALL_LIBDIR=%{_libdir} -DCMAKE_INSTALL_SYSCONFDIR=%{_sysconfdir} -DCMAKE_INSTALL_DATAROOTDIR=%{_datarootdir} -DCMAKE_INSTALL_DATADIR=%{_datadir} -DCMAKE_INSTALL_LIBEXECDIR=%{_libexecdir} -DGSETTINGS_LOCALINSTALL=ON -DGSETTINGS_COMPILE=OFF
make %{?_smp_mflags}

%install
make install DESTDIR=%{buildroot}
%find_lang %{name}

%clean
rm -rf %{buildroot}


%postun
set -o monitor
if [ $1 -eq 0 ] ; then
    /usr/bin/glib-compile-schemas %{_datadir}/glib-2.0/schemas &> /dev/null || :
fi

%posttrans
set -o monitor
/usr/bin/glib-compile-schemas %{_datadir}/glib-2.0/schemas &> /dev/null || :

%files
%defattr(644,root,root,755)
%doc README.md
%dir %{_libdir}/vala-panel
%dir %{_libdir}/vala-panel/applets
%{_libdir}/vala-panel/applets/libappmenu-valapanel.so
%{_libdir}/vala-panel/applets/appmenu.plugin

%package lang
Group: User Interface/Desktops
Summary: Translations for %{name}
Requires: vala-panel-appmenu-plugin
BuildArch: noarch
%description lang
This is a translation files for %{name} package.
%files lang -f %{name}.lang
%defattr(644,root,root,755)

%package -n xfce4-vala-panel-appmenu-plugin
Group: System/GUI/XFCE
Summary: This package provides Application Menu plugin for xfce4-panel
Requires: bamf-daemon
Provides: vala-panel-appmenu-plugin
%description -n xfce4-vala-panel-appmenu-plugin
This is Application Menu (Global Menu) plugin.
It built using Unity protocol and libraries,
and share all Unity limitations and advancements.
%files -n xfce4-vala-panel-appmenu-plugin
%defattr(644,root,root,755)
%dir %{_libdir}/xfce4
%dir %{_libdir}/xfce4/panel
%dir %{_libdir}/xfce4/panel/plugins
%dir %{_datadir}/xfce4
%dir %{_datadir}/xfce4/panel
%dir %{_datadir}/xfce4/panel/plugins
%{_libdir}/xfce4/panel/plugins/libappmenu-xfce.so
%{_datadir}/xfce4/panel/plugins/appmenu.desktop

%package -n mate-vala-panel-appmenu-plugin
Group: System/GUI/MATE
Summary: This package provides Application Menu plugin for mate-panel
Requires: bamf-daemon
Provides: vala-panel-appmenu-plugin
%description -n mate-vala-panel-appmenu-plugin
This is Application Menu (Global Menu) plugin.
It built using Unity protocol and libraries,
and share all Unity limitations and advancements.
%files -n mate-vala-panel-appmenu-plugin
%defattr(644,root,root,755)
%dir %{_libexecdir}/mate-panel
%dir %{_datadir}/dbus-1
%dir %{_datadir}/dbus-1/services
%dir %{_datadir}/mate-panel
%dir %{_datadir}/mate-panel/applets
%{_datadir}/dbus-1/services/org.mate.panel.applet.AppmenuAppletFactory.service
%{_libexecdir}/mate-panel/appmenu-mate
%{_datadir}/mate-panel/applets/org.vala-panel.appmenu.mate-panel-applet

%package -n budgie-vala-panel-appmenu-plugin
Group: System/GUI/Budgie
Summary: This package provides Application Menu plugin for budgie-panel
Requires: bamf-daemon
Provides: vala-panel-appmenu-plugin
%description -n budgie-vala-panel-appmenu-plugin
This is Application Menu (Global Menu) plugin.
It built using Unity protocol and libraries,
and share all Unity limitations and advancements.
%files -n budgie-vala-panel-appmenu-plugin
%defattr(644,root,root,755)
%doc README.md
%dir %{_libdir}/budgie-desktop
%dir %{_libdir}/budgie-desktop/plugins
%dir %{_libdir}/budgie-desktop/plugins/budgie-vala-panel-appmenu-plugin
%{_libdir}/budgie-desktop/plugins/budgie-vala-panel-appmenu-plugin/libappmenu-budgie.so
%{_libdir}/budgie-desktop/plugins/budgie-vala-panel-appmenu-plugin/appmenu-budgie.plugin

%package -n vala-panel-appmenu-registrar
Group:  User Interface/Desktops
Summary: This package provides Registrar daemon for DBusMenu implementations
%description -n vala-panel-appmenu-registrar
This is Application Menu (Global Menu) Registrar.
It is required for handle DBusMenu menus (Qt and Chromium, for example).
%files -n vala-panel-appmenu-registrar
%defattr(644,root,root,755)
%dir %{_libexecdir}/vala-panel
%dir %{_datadir}/dbus-1
%dir %{_datadir}/dbus-1/services
%{_datadir}/dbus-1/services/com.canonical.AppMenu.Registrar.service
%{_libexecdir}/vala-panel/appmenu-registrar

%changelog
* Mon Apr 27 2015 Konstantin <ria.freelander@gmail.com> - @CPACK_PACKAGE_VERSION@
  Generated by CMake UseRPMTools macros
